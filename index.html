<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Race: Neural Velocity</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Segoe UI', sans-serif; color: #fff; touch-action: none; }
        #ui { position: absolute; top: 20px; width: 100%; display: flex; justify-content: space-around; pointer-events: none; z-index: 10; }
        .stat { text-align: center; text-transform: uppercase; letter-spacing: 2px; }
        .val { font-size: 24px; font-weight: bold; color: #00f2ff; }
        canvas { display: block; }
        #msg { position: absolute; top: 50%; width: 100%; text-align: center; font-size: 18px; opacity: 0.5; pointer-events: none; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat">Focus<br><span id="score" class="val">0</span></div>
    <div class="stat">Velocity<br><span id="speed" class="val">0</span></div>
</div>
<div id="msg">MOVE TO START</div>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score = 0, speed = 4, gameActive = false, playerX = canvas.width / 2;
let obstacles = [];

// Audio System
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSound(f, type = 'sine') {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type; o.frequency.value = f;
    o.connect(g); g.connect(audioCtx.destination);
    g.gain.setValueAtTime(0.1, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
    o.start(); o.stop(audioCtx.currentTime + 0.3);
}

class Obstacle {
    constructor() {
        this.r = 15 + Math.random() * 20;
        this.x = Math.random() * (canvas.width - this.r * 2) + this.r;
        this.y = -50;
        this.type = Math.random() > 0.4 ? 'bad' : 'good'; // Red is obstacle, Green is boost
        this.color = this.type === 'bad' ? '#ff3e3e' : '#00ff88';
    }
    update() {
        this.y += speed;
        // Collision Detection (Matematik aniq)
        const dx = this.x - playerX;
        const dy = this.y - (canvas.height - 100);
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < this.r + 20) {
            if (this.type === 'bad') gameOver();
            else {
                score += 10;
                this.y = canvas.height + 100; // Remove
                speed += 0.2;
                playSound(600);
            }
        }
    }
    draw() {
        ctx.shadowBlur = 15; ctx.shadowColor = this.color;
        ctx.fillStyle = this.color;
        ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2); ctx.fill();
        ctx.shadowBlur = 0;
    }
}

function draw() {
    ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Track lines (Visual illusion of speed)
    ctx.strokeStyle = '#111';
    for(let i=0; i<5; i++) {
        let lx = (canvas.width / 5) * i;
        ctx.beginPath(); ctx.moveTo(lx, 0); ctx.lineTo(lx, canvas.height); ctx.stroke();
    }

    // Player (Ego Core)
    ctx.shadowBlur = 20; ctx.shadowColor = '#00f2ff';
    ctx.fillStyle = '#00f2ff';
    ctx.beginPath(); ctx.arc(playerX, canvas.height - 100, 20, 0, Math.PI * 2); ctx.fill();
    ctx.shadowBlur = 0;

    if (gameActive) {
        if (Math.random() < 0.03) obstacles.push(new Obstacle());
        obstacles.forEach((ob, i) => {
            ob.update();
            ob.draw();
            if (ob.y > canvas.height) {
                if(ob.y < canvas.height + 50) score++;
                obstacles.splice(i, 1);
            }
        });
        document.getElementById('score').innerText = score;
        document.getElementById('speed').innerText = Math.floor(speed * 10);
    }

    requestAnimationFrame(draw);
}

window.addEventListener('pointermove', (e) => {
    playerX = e.clientX;
    if (!gameActive) {
        gameActive = true;
        document.getElementById('msg').style.display = 'none';
        playSound(440);
    }
});

function gameOver() {
    gameActive = false;
    playSound(100, 'sawtooth');
    alert("NEURAL DISCONNECT\nYour Mind Velocity: " + Math.floor(speed * 10) + "\nTotal Focus: " + score);
    location.reload();
}

draw();
</script>
</body>
</html>