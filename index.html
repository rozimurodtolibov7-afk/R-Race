<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>R-Runner: Color Shift</title>
    <style>
        :root { --red: #ff4757; --blue: #2f3542; --neon-blue: #70a1ff; --bg: #1e272e; }
        body { margin: 0; overflow: hidden; background: var(--bg); color: white; font-family: 'Arial Black', sans-serif; touch-action: none; }
        
        #game-view { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
        
        /* HUD */
        #hud { position: fixed; top: 20px; width: 100%; display: flex; justify-content: space-around; z-index: 100; pointer-events: none; }
        .stat { background: rgba(0,0,0,0.6); padding: 10px 20px; border-radius: 15px; border: 2px solid white; }

        /* Character */
        #runner { position: absolute; bottom: 150px; left: 50%; transform: translateX(-50%); width: 60px; height: 60px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 40px; border: 4px solid white; transition: background 0.2s, left 0.1s; z-index: 50; }
        .runner-red { background: var(--red); box-shadow: 0 0 20px var(--red); }
        .runner-blue { background: var(--neon-blue); box-shadow: 0 0 20px var(--neon-blue); }

        /* Obstacles */
        .gate { position: absolute; top: -100px; width: 100%; height: 40px; display: flex; z-index: 40; }
        .gate-half { width: 50%; height: 100%; }

        /* Controls */
        #controls { position: fixed; bottom: 40px; width: 100%; display: flex; justify-content: space-around; z-index: 200; }
        .btn { width: 100px; height: 100px; border-radius: 20px; border: 3px solid white; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; }
        #btn-move { background: rgba(255,255,255,0.1); }
        #btn-shift { background: linear-gradient(45deg, var(--red), var(--neon-blue)); }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; text-align: center; }
        button { padding: 15px 50px; font-size: 22px; background: white; border: none; color: black; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>

<div id="hud">
    <div class="stat">SCORE: <span id="score">0</span></div>
    <div class="stat">RC: <span id="rc">0</span></div>
</div>

<div id="game-view">
    <div id="runner" class="runner-red">üèÉ</div>
</div>

<div id="controls">
    <div class="btn" id="btn-move"><b>‚ÜîÔ∏è</b>MOVE</div>
    <div class="btn" id="btn-shift"><b>‚ôªÔ∏è</b>SHIFT</div>
</div>

<div id="start-screen" class="overlay">
    <h1 style="font-size: 45px;">COLOR SHIFT RUNNER</h1>
    <p>1. Tap MOVE to switch lanes<br>2. Tap SHIFT to change color<br>3. Match the gate color to pass!</p>
    <button onclick="initGame()">START RUN</button>
</div>

<script>
    let score = 0, rc = 0;
    let gameActive = false;
    let isRed = true;
    let isLeft = true;
    const runner = document.getElementById('runner');
    const view = document.getElementById('game-view');
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // --- CYBER MUSIC SYSTEM ---
    function playMusic() {
        if(!gameActive) return;
        const notes = [110, 146, 164, 110, 196]; // Synth-wave sequence
        notes.forEach((freq, i) => {
            setTimeout(() => {
                if(!gameActive) return;
                let osc = audioCtx.createOscillator();
                let gain = audioCtx.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
                osc.connect(gain); gain.connect(audioCtx.destination);
                gain.gain.setValueAtTime(0.03, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.5);
                osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            }, i * 400);
        });
        setTimeout(playMusic, notes.length * 400);
    }

    function playEffect(f, type) {
        let osc = audioCtx.createOscillator();
        let gain = audioCtx.createGain();
        osc.type = type; osc.frequency.value = f;
        osc.connect(gain); gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
        osc.start(); osc.stop(audioCtx.currentTime + 0.2);
    }

    // Controls
    document.getElementById('btn-move').onpointerdown = () => {
        if(!gameActive) return;
        isLeft = !isLeft;
        runner.style.left = isLeft ? '25%' : '75%';
        playEffect(400, 'sine');
    };

    document.getElementById('btn-shift').onpointerdown = () => {
        if(!gameActive) return;
        isRed = !isRed;
        runner.className = isRed ? 'runner-red' : 'runner-blue';
        playEffect(800, 'sine');
    };

    function initGame() {
        document.getElementById('start-screen').style.display = 'none';
        gameActive = true;
        if(audioCtx.state === 'suspended') audioCtx.resume();
        playMusic();
        spawnGate();
        updateScore();
    }

    function spawnGate() {
        if(!gameActive) return;
        const gate = document.createElement('div');
        gate.className = 'gate';
        
        const leftRed = Math.random() > 0.5;
        gate.innerHTML = `
            <div class="gate-half" style="background:${leftRed ? '#ff4757' : '#70a1ff'}"></div>
            <div class="gate-half" style="background:${leftRed ? '#70a1ff' : '#ff4757'}"></div>
        `;
        view.appendChild(gate);

        let pos = -100;
        const move = setInterval(() => {
            if(!gameActive) { clearInterval(move); gate.remove(); return; }
            pos += (5 + score/500);
            gate.style.top = pos + 'px';

            // Collision check
            if(pos > (window.innerHeight - 210) && pos < (window.innerHeight - 150)) {
                const wallIsRed = isLeft ? leftRed : !leftRed;
                if(isRed !== wallIsRed) {
                    endGame();
                }
            }

            if(pos > window.innerHeight) {
                score += 10;
                rc += 2;
                updateScore();
                clearInterval(move);
                gate.remove();
            }
        }, 20);

        setTimeout(spawnGate, 2000 - (score > 1500 ? 500 : score/4));
    }

    function updateScore() {
        document.getElementById('score').innerText = score;
        document.getElementById('rc').innerText = rc;
    }

    function endGame() {
        gameActive = false;
        playEffect(100, 'sawtooth');
        alert("CRASHED! Wrong Color.\nFinal Score: " + score);
        location.reload();
    }
</script>
</body>
</html>